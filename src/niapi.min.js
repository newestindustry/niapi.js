/*jslint continue:true*//**
 * Adapted from {@link http://www.bulgaria-web-developers.com/projects/javascript/serialize/}
 * Changes:
 *     Ensures proper URL encoding of name as well as value
 *     Preserves element order
 *     XHTML and JSLint-friendly
 *     Disallows disabled form elements and reset buttons as per HTML4 [successful controls]{@link http://www.w3.org/TR/html401/interact/forms.html#h-17.13.2}
 *         (as used in jQuery). Note: This does not serialize <object>
 *         elements (even those without a declare attribute) or
 *         <input type="file" />, as per jQuery, though it does serialize
 *         the <button>'s (which are potential HTML4 successful controls) unlike jQuery
 * @license MIT/GPL
*/function niapi_serialize(e){"use strict";function u(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function a(e,t){o.push(u(e)+"="+u(t))}var t,n,r,i,s,o=[];if(!e||!e.nodeName||e.nodeName.toLowerCase()!=="form")throw"You must supply a form element";for(t=0,r=e.elements.length;t<r;t++){s=e.elements[t];if(s.name===""||s.disabled)continue;switch(s.nodeName.toLowerCase()){case"input":switch(s.type){case"text":case"hidden":case"password":case"button":case"submit":a(s.name,s.value);break;case"checkbox":case"radio":s.checked&&a(s.name,s.value);break;case"file":break;case"reset":}break;case"textarea":a(s.name,s.value);break;case"select":switch(s.type){case"select-one":a(s.name,s.value);break;case"select-multiple":for(n=0,i=s.options.length;n<i;n++)s.options[n].selected&&a(s.name,s.options[n].value)}break;case"button":switch(s.type){case"reset":case"submit":case"button":a(s.name,s.value)}}}return o.join("&")}function NI(){return window===this?new NI:this}NI.prototype={};NI.Me=!1;NI.Options={api_url:"https://api.newestindustry.nl",auth_url:"/oauth/auth/",client_id:!1,redirect_url:!1,scope:"default",oauth_token:!1,refresh_token:!1,sidebar_force_margin:!0,comments_include_hash:!0,Set:function(e){var t=["api_url","auth_url","client_id","redirect_url","scope","oauth_token","refresh_token","sidebar_force_margin","comments_include_hash"];if(typeof e=="object")for(var n=0;n<t.length;n++)this[t[n]]=typeof e[t[n]]!="undefined"?e[t[n]]:this[t[n]];NI.Api.parseToken()},setToken:function(e){NI.Options.oauth_token=e;localStorage.oauth_token=NI.Options.oauth_token}};NI.Api={error:!1,Get:function(e,t){this.call({url:e,method:"GET"},t)},Post:function(e,t,n){this.call({url:e,data:t,method:"POST"},n)},Put:function(e,t,n){this.call({url:e,data:t,method:"PUT"},n)},Delete:function(e,t,n){this.call({url:e,method:"DELETE"},n)},call:function(e,t){var n,r,i,s,o,u;if(typeof e=="object"){n=typeof e.url!="undefined"?NI.Options.api_url+e.url:!1;r=typeof e.url!="undefined"?e.method.toUpperCase():"GET";i=typeof e.url!="undefined"?e.data:!1}typeof t=="undefined"&&(t=NI.emptyCallback);try{o=new XMLHttpRequest}catch(a){try{o=new ActiveXObject("Msxml2.XMLHTTP")}finally{typeof console!="undefined"&&console.log("NIApi: Not supported");return null}}s=setTimeout(function(){o.abort();t(new Error("NIApi: Timeout Reached"),"",o)},1e4);o.onreadystatechange=function(){if(o.readyState!==4)return;clearTimeout(s);if(o.status===200||o.status===201||o.status===204)u=!1;else if(o.status===401){NI.Profile.Logout();u=new Error("NIApi: Access denied")}else u=new Error("NIApi: Response status: "+o.status);var e;o.getResponseHeader("content-type").indexOf("application/json")!==-1?e=JSON.parse(o.responseText):e=o.responseText;t(u,e,o)};o.open(r,n,!0);NI.Options.oauth_token&&o.setRequestHeader("Authorization","oauth_token "+NI.Options.oauth_token);if(!i)o.send();else{o.setRequestHeader("Content-type","application/x-www-form-urlencoded");o.send(i)}return!1},toQueryString:function(e){var t="",n="";for(var r in e){t+=n;t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]);n="&"}return t},parseToken:function(){var e={},t=location.hash.substring(1),n=/([^&=]+)=([^&]*)/g,r=n.exec(t);r&&(e[decodeURIComponent(r[1])]=decodeURIComponent(r[2]));e.token?NI.Options.setToken(e.token):localStorage.oauth_token&&NI.Options.setToken(localStorage.oauth_token);e.error&&(NI.Api.error=e.error)},emptyCallback:function(){}};NI.Profile={Me:function(e){NI.Api.Get("/me",function(t,n){NI.Me=n.me;e(t,n)})},Login:function(){NI.Options.oauth_token||(location.href=NI.Options.api_url+NI.Options.auth_url+"?response_type=token&client_id="+NI.Options.client_id+"&redirect_uri="+NI.Options.redirect_url+"&scope="+NI.Options.scope)},Logout:function(){NI.Options.oauth_token&&NI.Api.Delete("/oauth/token",NI.Api.emptyCallback);NI.Options.oauth_token=!1;localStorage.removeItem("oauth_token")}};NI.Sidebar={Get:function(){var e=document.getElementById("ni-root");e&&NI.Api.Get("/frontend/menu/left/_format/html",function(e,t){document.getElementById("ni-root").innerHTML=t;if(NI.Options.sidebar_force_margin===!0){document.body.style.marginLeft="230px";NI.Messages.GetSidebarCount()}})}};NI.Comments={url:!1,setUrl:function(e){e?e=e:typeof e!="undefined"?e=e:NI.Options.comments_include_hash?e=window.location.href:e=window.location.href.replace(window.location.hash,"");return e},Get:function(e,t){t=this.setUrl(t);typeof e=="undefined"&&(e="ni-comments");var n=document.getElementById(e);n&&NI.Api.Get("/comments/_format/html/element/"+e+"/url/"+encodeURIComponent(t),function(r,i){n.innerHTML=i;document.getElementById("niCreateCommentFormUrl"+e).value=t;NI.Comments.fixSubmit(e,t)})},fixSubmit:function(e,t){document.getElementById("niCreateComment"+e).onsubmit=function(){var n=niapi_serialize(document.getElementById("niCreateComment"+e));NI.Comments.Create(n,e,t);return!1}},Create:function(e,t,n){NI.Api.Post("/comments/_format/html/element/"+t+"/url/"+encodeURIComponent(n),e,function(e){e||NI.Comments.Get(t,n)})}};NI.Messages={GetSidebar:function(){NI.Api.Get("/mail/messages/thread/false/_limit/5/_sort/created/_direction/desc/_format/html",function(e,t){document.getElementById("ni-messagesPreviewList").innerHTML=t;document.getElementById("ni-messagesPreview").style.display==="none"?document.getElementById("ni-messagesPreview").style.display="block":document.getElementById("ni-messagesPreview").style.display="none"})},GetSidebarCount:function(){NI.Api.Get("/mail/messages/thread/false/read/false/_limit/1",function(e,t){document.getElementById("ni-totalUnreadMessages").innerHTML=t.total})}};