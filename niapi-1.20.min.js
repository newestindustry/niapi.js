/**
 * Adapted from {@link http://www.bulgaria-web-developers.com/projects/javascript/serialize/}
 * Changes:
 *     Ensures proper URL encoding of name as well as value
 *     Preserves element order
 *     XHTML and JSLint-friendly
 *     Disallows disabled form elements and reset buttons as per HTML4 [successful controls]{@link http://www.w3.org/TR/html401/interact/forms.html#h-17.13.2}
 *         (as used in jQuery). Note: This does not serialize <object>
 *         elements (even those without a declare attribute) or
 *         <input type="file" />, as per jQuery, though it does serialize
 *         the <button>'s (which are potential HTML4 successful controls) unlike jQuery
 * @license MIT/GPL
*/
function niapi_serialize(e){"use strict";function t(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function n(e,n){r.push(t(e)+"="+t(n))}var o,a,i,s,l,r=[];if(!e||!e.nodeName||"form"!==e.nodeName.toLowerCase())throw"You must supply a form element";for(o=0,i=e.elements.length;i>o;o++)if(l=e.elements[o],""!==l.name&&!l.disabled)switch(l.nodeName.toLowerCase()){case"input":switch(l.type){case"text":case"hidden":case"password":case"button":case"submit":n(l.name,l.value);break;case"checkbox":case"radio":l.checked&&n(l.name,l.value);break;case"file":break;case"reset":}break;case"textarea":n(l.name,l.value);break;case"select":switch(l.type){case"select-one":n(l.name,l.value);break;case"select-multiple":for(a=0,s=l.options.length;s>a;a++)l.options[a].selected&&n(l.name,l.options[a].value)}break;case"button":switch(l.type){case"reset":case"submit":case"button":n(l.name,l.value)}}return r.join("&")}function NI(){return window===this?new NI:this}!function(){function e(){if(!l&&(l=!0,r)){for(var e=0;e<r.length;e++)r[e].call(window,[]);r=[]}}function t(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t&&t(),e()}}function n(){if(!s){if(s=!0,document.addEventListener&&!i.opera&&document.addEventListener("DOMContentLoaded",e,!1),i.msie&&window==top&&function(){if(!l){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}(),i.opera&&document.addEventListener("DOMContentLoaded",function(){if(!l){for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].disabled)return void setTimeout(arguments.callee,0);e()}},!1),i.safari){var n;!function(){if(!l){if("loaded"!=document.readyState&&"complete"!=document.readyState)return void setTimeout(arguments.callee,0);if("undefined"==typeof n){for(var t=document.getElementsByTagName("link"),o=0;o<t.length;o++)"stylesheet"==t[o].getAttribute("rel")&&n++;var a=document.getElementsByTagName("style");n+=a.length}return document.styleSheets.length!=n?void setTimeout(arguments.callee,0):void e()}}()}t(e)}}var o=window.DomReady={},a=navigator.userAgent.toLowerCase(),i={version:(a.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(a),opera:/opera/.test(a),msie:/msie/.test(a)&&!/opera/.test(a),mozilla:/mozilla/.test(a)&&!/(compatible|webkit)/.test(a)},s=!1,l=!1,r=[];o.ready=function(e,t){n(),l?e.call(window,[]):r.push(function(){return e.call(window,[])})},n()}(),NI.Options={api_url:"https://api.newestindustry.nl",auth_url:"https://auth.newestindustry.nl",client_id:!1,redirect_url:!1,scope:"default",oauth_token:!1,refresh_token:!1,auth_redirect_type:"hash",sidebar_force_margin:!0,load_css:!0,comments_include_hash:!0,comments_form_position:"bottom",comments_reverse:!1,comments_css:!0,Set:function(e){var t=["api_url","auth_url","client_id","redirect_url","scope","oauth_token","refresh_token","auth_redirect_type","sidebar_force_margin","comments_include_hash","comments_form_position","comments_reverse","comments_css","load_css"];if("object"==typeof e)for(var n=0;n<t.length;n++)this[t[n]]="undefined"!=typeof e[t[n]]?e[t[n]]:this[t[n]];NI.Api.parseToken()},setToken:function(e){NI.Options.oauth_token=e,localStorage.oauth_token=NI.Options.oauth_token}},NI.Api={error:!1,Get:function(e,t){this.call({url:e,method:"GET"},t)},Post:function(e,t,n){this.call({url:e,data:t,method:"POST"},n)},Put:function(e,t,n){this.call({url:e,data:t,method:"PUT"},n)},Delete:function(e,t){this.call({url:e,method:"DELETE"},t)},call:function(e,t){var n,o,a,i,s,l;"object"==typeof e&&(n="undefined"!=typeof e.url?NI.Options.api_url+e.url:!1,o="undefined"!=typeof e.url?e.method.toUpperCase():"GET",a="undefined"!=typeof e.url?e.data:!1),"undefined"==typeof t&&(t=NI.Api.emptyCallback);try{s=new XMLHttpRequest}catch(r){try{s=new ActiveXObject("Msxml2.XMLHTTP")}finally{return"undefined"!=typeof console&&console.log("NIApi: Not supported"),null}}return i=setTimeout(function(){s.abort(),t(new Error("NIApi: Timeout Reached"),"",s)},1e4),s.onreadystatechange=function(){if(4===s.readyState){clearTimeout(i),200===s.status||201===s.status||204===s.status?l=!1:401===s.status?(NI.Profile.Logout(),l=new Error("NIApi: Access denied")):l=new Error("NIApi: Response status: "+s.status);var e;e="undefined"!=typeof s.getResponseHeader("content-type")&&null!==s.getResponseHeader("content-type")&&-1!==s.getResponseHeader("content-type").indexOf("application/json")&&204!==s.status?JSON.parse(s.responseText):s.responseText,t(l,e,s)}},s.open(o,n,!0),NI.Options.oauth_token&&s.setRequestHeader("Authorization","oauth_token "+NI.Options.oauth_token),a&&0!==a.length&&"undefined"!=typeof a.length?(s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(a)):s.send(),!1},toQueryString:function(e){var t="",n="";for(var o in e)t+=n,t+=encodeURIComponent(o)+"="+encodeURIComponent(e[o]),n="&";return t},parseToken:function(){var e={},t=location.hash.substring(1),n=/([^&=]+)=([^&]*)/g,o=n.exec(t);o&&(e[decodeURIComponent(o[1])]=decodeURIComponent(o[2])),e.token?(NI.Options.setToken(e.token),window.location.href=window.location.href.replace(window.location.hash,"")):localStorage.oauth_token&&NI.Options.setToken(localStorage.oauth_token),e.error&&(NI.Api.error=e.error)},emptyCallback:function(){}},NI.Profile={Me:function(e){NI.Api.Get("/me",function(t,n){NI.Me=n.me,e(t,n)})},Login:function(){NI.Options.oauth_token||(location.href=NI.Options.auth_url+"?response_type=token&client_id="+NI.Options.client_id+"&redirect_uri="+NI.Options.redirect_url+"&scope="+NI.Options.scope+"&redirect_type="+NI.Options.auth_redirect_type)},Logout:function(){return NI.Options.oauth_token&&(NI.Api.Delete("/token",NI.Api.emptyCallback),window.location.href=window.location.href),NI.Options.oauth_token=!1,localStorage.removeItem("oauth_token"),!1}},NI.Sidebar={injectCss:function(){var e=document.getElementById("niCssSidebar");if(!e){var t=document.createElement("link");t.href="https://cdn.newestindustry.nl/css/modules/ni-profilebar-1.6.css",t.type="text/css",t.rel="stylesheet",t.id="niCssSidebar",document.getElementsByTagName("head")[0].appendChild(t)}},Get:function(e){var t=document.getElementById("ni-root"),n=document.getElementsByTagName("body")[0];t&&NI.Api.Get("/frontend/menu/left/_format/html",function(t,o){document.getElementById("ni-root").innerHTML=o,NI.Messages.GetSidebarCount(),NI.Notifications.GetSidebarCount(),n.onkeydown=function(e){var t=e.keyCode,n=!!document.getElementById("ni-messagesPreview");if(n===!0&&27===t){var o=document.getElementById("ni-messagesPreview");"undefined"!=typeof o&&null!==typeof o&&"null"!=typeof o&&"none"!==o.style.display&&(o.style.display="none")}},NI.Options.sidebar_force_margin===!0&&(document.body.style.marginLeft="230px"),e&&"function"==typeof e&&e()})},ShowSettings:function(){if(-1===document.getElementById("buttonOpenSettings").className.indexOf("active"))document.getElementById("buttonOpenSettings").className+=" active";else{var e=document.getElementById("buttonOpenSettings").className.replace("active","");document.getElementById("buttonOpenSettings").className=e}return!1},Remove:function(){var e=document.getElementById("ni-profile-menu-left");e&&(e.parentNode.removeChild(e),NI.Options.sidebar_force_margin===!0&&(document.body.style.marginLeft="0px"))}},NI.Favorite={Prepare:function(){for(var e=document.getElementsByClassName("ni-favorite"),t=0;t<e.length;t++)NI.Favorite.Init(e[t]),e[t].onclick=function(){return NI.Favorite.Click(this),!1}},Init:function(e){var t=e.dataset.loaded;if("undefined"==typeof t){var n=e.dataset.href,o,a=e.dataset.styleClass,i=e.dataset.styleActive,s=e.dataset.styleIcon,l=e.dataset.styleIconActive;o="undefined"!=typeof n&&""!==n?n:window.location.href;var r=document.createElement("a");r.className="btn",r.href="";var c=document.createElement("i");"undefined"!=typeof s?c.className="fa "+s:c.className="fa fa-heart-o","undefined"!=typeof a&&(newClassName=r.className+" "+a,r.className=newClassName),e.appendChild(r),r.appendChild(c),e.dataset.loaded=!0,NI.Options.oauth_token&&NI.Api.Get("/favorites/url/"+encodeURIComponent(o),function(t,n,o){if(200===o.status){var a=e.getElementsByClassName("fa");for(o=0;o<a.length;o++)"undefined"!=typeof l?a[o].className="fa "+l:a[o].className="fa fa-heart";"undefined"!=typeof i&&(r.className=r.className+" "+i)}})}},Click:function(element){var href=element.dataset.href,url,a,func,tag=element.dataset.tag,activeClass=element.dataset.styleActive,alternativeIcon=element.dataset.styleIcon,alternativeActiveIcon=element.dataset.styleIconActive,postCallbackCreated=element.dataset.postCallbackCreated,postCallbackRemoved=element.dataset.postCallbackRemoved,callbackFunction=element.dataset.callback;url="undefined"!=typeof href&&""!==href?href:window.location.href,NI.Api.Post("/favorites/","url="+encodeURIComponent(url)+"&tag="+tag,function(error,data,x){if(201===x.status){for(i=element.getElementsByClassName("fa"),x=0;x<i.length;x++)"undefined"!=typeof alternativeActiveIcon?i[x].className="fa "+alternativeActiveIcon:i[x].className="fa fa-heart";if("undefined"!=typeof activeClass)for(a=element.getElementsByClassName("btn"),x=0;x<a.length;x++)a[x].className=a[x].className+" "+activeClass;postCallbackCreated&&("function"==typeof postCallbackCreated?postCallbackCreated():eval(postCallbackCreated))}else{for(i=element.getElementsByClassName("fa"),x=0;x<i.length;x++)"undefined"!=typeof alternativeIcon?i[x].className="fa "+alternativeIcon:i[x].className="fa fa-heart-o";if("undefined"!=typeof activeClass)for(a=element.getElementsByClassName("btn"),x=0;x<a.length;x++)a[x].className=a[x].className.replace(activeClass,"").trim();postCallbackRemoved&&("function"==typeof postCallbackRemoved?postCallbackRemoved():eval(postCallbackRemoved))}callbackFunction&&window[callbackFunction](error,data,x,element)})}},NI.Comments={url:!1,idCounter:1,Prepare:function(){for(var e=document.getElementsByClassName("ni-comments"),t=0;t<e.length;t++){var n=e[t].dataset.href;""===e[t].id&&(e[t].id=NI.Comments.GenerateId()),NI.Comments.Get(e[t].id,n)}},injectCss:function(){var e=document.getElementById("niCssComments");if(!e){var t=document.createElement("link");t.href="https://cdn.newestindustry.nl/css/modules/ni-comments-1.6.css",t.type="text/css",t.rel="stylesheet",t.id="niCssComments",document.getElementsByTagName("head")[0].appendChild(t)}},setUrl:function(e){return e="undefined"!=typeof e?e:NI.Options.comments_include_hash===!0?window.location.href:window.location.href.replace(window.location.hash,"")},GenerateId:function(){var e="ni-comments-"+NI.Comments.idCounter;return NI.Comments.idCounter++,e},Get:function(e,t){NI.Options.comments_css===!0&&this.injectCss(),t=this.setUrl(t),"undefined"==typeof e&&(e=NI.Comments.GenerateId());var n=document.getElementById(e),o=n.dataset.formPosition,a=n.dataset.reverse;if("undefined"==typeof o&&(o=NI.Options.comments_form_position),"undefined"==typeof a&&(a=NI.Options.comments_reverse),n){var i="/comments/_format/html/_limit/50/element/"+e+"/url/"+encodeURIComponent(t);i+="/form_position/"+o+"/reverse/"+a,NI.Api.Get(i,function(o,a){n.innerHTML=a,NI.Options.oauth_token&&(document.getElementById("niCreateCommentFormUrl"+e).value=t,NI.Comments.fixSubmit(e,t),NI.Favorite.Prepare())})}},fixSubmit:function(e,t){document.getElementById("niCreateComment"+e).onsubmit=function(){var n=niapi_serialize(document.getElementById("niCreateComment"+e));return NI.Comments.Create(n,e,t),!1}},Create:function(e,t,n){NI.Api.Post("/comments/_format/html/_limit/50/element/"+t+"/url/"+encodeURIComponent(n),e,function(e){e||NI.Comments.Get(t,n)})}},NI.Notifications={Mark:function(e){NI.Api.Put("/notifications/id/"+e,{},function(t){t?alert("Er is iets fout gegaan"):"undefined"!=typeof document.getElementById("notification_"+e)&&document.getElementById("notification_"+e).remove()})},GetSidebarCount:function(){NI.Api.Get("/notifications/_direction/desc/read/false/_limit/1/type/!global",function(e,t){if(e)alert("Er is iets fout gegaan");else{var n=document.getElementById("ni-totalUnreadNotifications"),o=document.getElementById("notificationsTotalNew");n&&(n.innerHTML=t.total,0===t.total?n.style.display="none":n.style.display="block"),o&&(o.innerHTML=t.total,0===t.total?o.style.display="none":o.style.display="block")}});var e=document.getElementById("notification_badge_profile");e&&NI.Api.Get("/notifications/_direction/desc/read/false/_limit/1/module/profile/type/!global",function(t,n){0===n.total?e.style.display="none":(e.style.display="block",e.innerHTML=n.total)});var t=document.getElementById("notification_badge_collective");t&&NI.Api.Get("/notifications/_direction/desc/read/false/_limit/1/module/collectives/type/!global",function(e,n){0===n.total?t.style.display="none":(t.style.display="block",t.innerHTML=n.total)})}},NI.Messages={GetSidebar:function(){NI.Api.Get("/mail/messages/thread/false/_limit/5/_sort/created/_direction/desc/_format/html",function(e,t){document.getElementById("ni-messagesPreviewList").innerHTML=t,"none"===document.getElementById("ni-messagesPreview").style.display?document.getElementById("ni-messagesPreview").style.display="block":document.getElementById("ni-messagesPreview").style.display="none"})},GetSidebarCount:function(){NI.Api.Get("/mail/messages/thread/false/read/false/_limit/1",function(e,t){var n=document.getElementById("ni-totalUnreadMessages");"undefined"!=typeof n&&(n.innerHTML=t.total,0===t.total?n.style.display="none":n.style.display="block")})}},NI.injectCss=function(){var e=document.getElementById("niCssFontAwesome");if(!e){var t=document.createElement("link");t.href="https://netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css",t.type="text/css",t.rel="stylesheet",t.id="niCssFontAwesome",document.getElementsByTagName("head")[0].appendChild(t)}var n=document.getElementById("niCssOpenSans");if(!n){var o=document.createElement("link");o.href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800",o.type="text/css",o.rel="stylesheet",o.id="niCssOpenSans",document.getElementsByTagName("head")[0].appendChild(o)}},DomReady.ready(function(){NI.Favorite.Prepare(),NI.Comments.Prepare(),NI.Options.load_css===!0&&NI.injectCss()}),NI.Me=!1;