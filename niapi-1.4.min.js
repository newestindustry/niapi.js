function niapi_serialize(e){"use strict";function u(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function a(e,t){o.push(u(e)+"="+u(t))}var t,n,r,i,s,o=[];if(!e||!e.nodeName||e.nodeName.toLowerCase()!=="form")throw"You must supply a form element";for(t=0,r=e.elements.length;t<r;t++){s=e.elements[t];if(s.name===""||s.disabled)continue;switch(s.nodeName.toLowerCase()){case"input":switch(s.type){case"text":case"hidden":case"password":case"button":case"submit":a(s.name,s.value);break;case"checkbox":case"radio":s.checked&&a(s.name,s.value);break;case"file":break;case"reset":}break;case"textarea":a(s.name,s.value);break;case"select":switch(s.type){case"select-one":a(s.name,s.value);break;case"select-multiple":for(n=0,i=s.options.length;n<i;n++)s.options[n].selected&&a(s.name,s.options[n].value)}break;case"button":switch(s.type){case"reset":case"submit":case"button":a(s.name,s.value)}}}return o.join("&")}function NI(){return window===this?new NI:this}(function(){function o(){if(!i){i=!0;if(s){for(var e=0;e<s.length;e++)s[e].call(window,[]);s=[]}}}function u(e){var t=window.onload;typeof window.onload!="function"?window.onload=e:window.onload=function(){t&&t();e()}}function a(){if(r)return;r=!0;document.addEventListener&&!n.opera&&document.addEventListener("DOMContentLoaded",o,!1);n.msie&&window==top&&function(){if(i)return;try{document.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}o()}();n.opera&&document.addEventListener("DOMContentLoaded",function(){if(i)return;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].disabled){setTimeout(arguments.callee,0);return}o()},!1);if(n.safari){var e;(function(){if(i)return;if(document.readyState!="loaded"&&document.readyState!="complete"){setTimeout(arguments.callee,0);return}if(typeof e=="undefined"){var t=document.getElementsByTagName("link");for(var n=0;n<t.length;n++)t[n].getAttribute("rel")=="stylesheet"&&e++;var r=document.getElementsByTagName("style");e+=r.length}if(document.styleSheets.length!=e){setTimeout(arguments.callee,0);return}o()})()}u(o)}var e=window.DomReady={},t=navigator.userAgent.toLowerCase(),n={version:(t.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(t),opera:/opera/.test(t),msie:/msie/.test(t)&&!/opera/.test(t),mozilla:/mozilla/.test(t)&&!/(compatible|webkit)/.test(t)},r=!1,i=!1,s=[];e.ready=function(e,t){a();i?e.call(window,[]):s.push(function(){return e.call(window,[])})};a()})();NI.injectCss=function(){var e=document.getElementById("niCssFontAwesome");if(!e){var t=document.createElement("link");t.href="https://netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css";t.type="text/css";t.rel="stylesheet";t.id="niCssFontAwesome";document.getElementsByTagName("head")[0].appendChild(t)}var n=document.getElementById("niCssOpenSans");if(!n){var r=document.createElement("link");r.href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800";r.type="text/css";r.rel="stylesheet";r.id="niCssOpenSans";document.getElementsByTagName("head")[0].appendChild(r)}};DomReady.ready(function(){NI.Favorite.Prepare();NI.Comments.Prepare()});NI.injectCss();NI.Me=!1;NI.Options={api_url:"https://api.mycollectiv.es",auth_url:"/oauth/auth/",client_id:!1,redirect_url:!1,scope:"default",oauth_token:!1,refresh_token:!1,auth_redirect_type:"hash",sidebar_force_margin:!0,comments_include_hash:!0,comments_form_position:"bottom",comments_reverse:!1,comments_css:!0,Set:function(e){var t=["api_url","auth_url","client_id","redirect_url","scope","oauth_token","refresh_token","auth_redirect_type","sidebar_force_margin","comments_include_hash","comments_form_position","comments_reverse","comments_css"];if(typeof e=="object")for(var n=0;n<t.length;n++)this[t[n]]=typeof e[t[n]]!="undefined"?e[t[n]]:this[t[n]];NI.Api.parseToken()},setToken:function(e){NI.Options.oauth_token=e;localStorage.oauth_token=NI.Options.oauth_token}};NI.Api={error:!1,Get:function(e,t){this.call({url:e,method:"GET"},t)},Post:function(e,t,n){this.call({url:e,data:t,method:"POST"},n)},Put:function(e,t,n){this.call({url:e,data:t,method:"PUT"},n)},Delete:function(e,t){this.call({url:e,method:"DELETE"},t)},call:function(e,t){var n,r,i,s,o,u;if(typeof e=="object"){n=typeof e.url!="undefined"?NI.Options.api_url+e.url:!1;r=typeof e.url!="undefined"?e.method.toUpperCase():"GET";i=typeof e.url!="undefined"?e.data:!1}typeof t=="undefined"&&(t=NI.Api.emptyCallback);try{o=new XMLHttpRequest}catch(a){try{o=new ActiveXObject("Msxml2.XMLHTTP")}finally{typeof console!="undefined"&&console.log("NIApi: Not supported");return null}}s=setTimeout(function(){o.abort();t(new Error("NIApi: Timeout Reached"),"",o)},1e4);o.onreadystatechange=function(){if(o.readyState!==4)return;clearTimeout(s);if(o.status===200||o.status===201||o.status===204)u=!1;else if(o.status===401){NI.Profile.Logout();u=new Error("NIApi: Access denied")}else u=new Error("NIApi: Response status: "+o.status);var e;o.getResponseHeader("content-type").indexOf("application/json")!==-1&&o.status!==204?e=JSON.parse(o.responseText):e=o.responseText;t(u,e,o)};o.open(r,n,!0);NI.Options.oauth_token&&o.setRequestHeader("Authorization","oauth_token "+NI.Options.oauth_token);if(!i)o.send();else{o.setRequestHeader("Content-type","application/x-www-form-urlencoded");o.send(i)}return!1},toQueryString:function(e){var t="",n="";for(var r in e){t+=n;t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]);n="&"}return t},parseToken:function(){var e={},t=location.hash.substring(1),n=/([^&=]+)=([^&]*)/g,r=n.exec(t);r&&(e[decodeURIComponent(r[1])]=decodeURIComponent(r[2]));if(e.token){NI.Options.setToken(e.token);window.location.href=window.location.href.replace(window.location.hash,"")}else localStorage.oauth_token&&NI.Options.setToken(localStorage.oauth_token);e.error&&(NI.Api.error=e.error)},emptyCallback:function(){}};NI.Profile={Me:function(e){NI.Api.Get("/me",function(t,n){NI.Me=n.me;e(t,n)})},Login:function(){NI.Options.oauth_token||(location.href=NI.Options.api_url+NI.Options.auth_url+"?response_type=token&client_id="+NI.Options.client_id+"&redirect_uri="+NI.Options.redirect_url+"&scope="+NI.Options.scope+"&redirect_type="+NI.Options.auth_redirect_type)},Logout:function(){if(NI.Options.oauth_token){NI.Api.Delete("/oauth/token",NI.Api.emptyCallback);window.location.href=window.location.href}NI.Options.oauth_token=!1;localStorage.removeItem("oauth_token");return!1}};NI.Sidebar={injectCss:function(){var e=document.getElementById("niCssSidebar");if(!e){var t=document.createElement("link");t.href="https://cdn.newestindustry.nl/css/modules/ni-profilebar-1.4.css";t.type="text/css";t.rel="stylesheet";t.id="niCssSidebar";document.getElementsByTagName("head")[0].appendChild(t)}},Get:function(e){this.injectCss();var t=document.getElementById("ni-root"),n=document.getElementsByTagName("body")[0];t&&NI.Api.Get("/frontend/menu/left/_format/html",function(t,r){document.getElementById("ni-root").innerHTML=r;NI.Messages.GetSidebarCount();NI.Notifications.GetSidebarCount();n.onkeydown=function(e){var t=document.getElementById("ni-messagesPreview"),n=e.keyCode;t.style.display!=="none"&&n===27&&(t.style.display="none")};NI.Options.sidebar_force_margin===!0&&(document.body.style.marginLeft="230px");e&&typeof e=="function"&&e()})},ShowSettings:function(){if(document.getElementById("buttonOpenSettings").className.indexOf("active")===-1)document.getElementById("buttonOpenSettings").className+=" active";else{var e=document.getElementById("buttonOpenSettings").className.replace("active","");document.getElementById("buttonOpenSettings").className=e}return!1},Remove:function(){var e=document.getElementById("ni-profile-menu-left");if(e){e.parentNode.removeChild(e);NI.Options.sidebar_force_margin===!0&&(document.body.style.marginLeft="0px")}}};NI.Comments={url:!1,idCounter:1,Prepare:function(){var e=document.getElementsByClassName("ni-comments");for(var t=0;t<e.length;t++){var n=e[t].dataset.href;e[t].id===""&&(e[t].id=NI.Comments.GenerateId());NI.Comments.Get(e[t].id,n)}},injectCss:function(){var e=document.getElementById("niCssComments");if(!e){var t=document.createElement("link");t.href="https://cdn.newestindustry.nl/css/modules/ni-comments-1.4.css";t.type="text/css";t.rel="stylesheet";t.id="niCssComments";document.getElementsByTagName("head")[0].appendChild(t)}},setUrl:function(e){typeof e!="undefined"?e=e:NI.Options.comments_include_hash===!0?e=window.location.href:e=window.location.href.replace(window.location.hash,"");return e},GenerateId:function(){var e="ni-comments-"+NI.Comments.idCounter;NI.Comments.idCounter++;return e},Get:function(e,t){NI.Options.comments_css===!0&&this.injectCss();t=this.setUrl(t);typeof e=="undefined"&&(e=NI.Comments.GenerateId());var n=document.getElementById(e),r=n.dataset.formPosition,i=n.dataset.reverse;typeof r=="undefined"&&(r=NI.Options.comments_form_position);typeof i=="undefined"&&(i=NI.Options.comments_reverse);if(n){var s="/comments/_format/html/_limit/50/element/"+e+"/url/"+encodeURIComponent(t);s+="/form_position/"+r+"/reverse/"+i;NI.Api.Get(s,function(r,i){n.innerHTML=i;if(NI.Options.oauth_token){document.getElementById("niCreateCommentFormUrl"+e).value=t;NI.Comments.fixSubmit(e,t);NI.Favorite.Prepare()}})}},fixSubmit:function(e,t){document.getElementById("niCreateComment"+e).onsubmit=function(){var n=niapi_serialize(document.getElementById("niCreateComment"+e));NI.Comments.Create(n,e,t);return!1}},Create:function(e,t,n){NI.Api.Post("/comments/_format/html/_limit/50/element/"+t+"/url/"+encodeURIComponent(n),e,function(e){e||NI.Comments.Get(t,n)})}};NI.Notifications={Mark:function(e){NI.Api.Put("/notifications/id/"+e,{},function(t){t?alert("Er is iets fout gegaan"):typeof document.getElementById("notification_"+e)!="undefined"&&document.getElementById("notification_"+e).remove()})},GetSidebarCount:function(){NI.Api.Get("/notifications/_direction/desc/read/false/_limit/1/type/!global",function(e,t){if(e)alert("Er is iets fout gegaan");else{var n=document.getElementById("ni-totalUnreadNotifications"),r=document.getElementById("notificationsTotalNew");if(n){n.innerHTML=t.total;t.total===0?n.style.display="none":n.style.display="block"}if(r){r.innerHTML=t.total;t.total===0?r.style.display="none":r.style.display="block"}}});var e=document.getElementById("notification_badge_profile");e&&NI.Api.Get("/notifications/_direction/desc/read/false/_limit/1/module/profile/type/!global",function(t,n){if(n.total===0)e.style.display="none";else{e.style.display="block";e.innerHTML=n.total}});var t=document.getElementById("notification_badge_collective");t&&NI.Api.Get("/notifications/_direction/desc/read/false/_limit/1/module/collectives/type/!global",function(e,n){if(n.total===0)t.style.display="none";else{t.style.display="block";t.innerHTML=n.total}})}};NI.Messages={GetSidebar:function(){NI.Api.Get("/mail/messages/thread/false/_limit/5/_sort/created/_direction/desc/_format/html",function(e,t){document.getElementById("ni-messagesPreviewList").innerHTML=t;document.getElementById("ni-messagesPreview").style.display==="none"?document.getElementById("ni-messagesPreview").style.display="block":document.getElementById("ni-messagesPreview").style.display="none"})},GetSidebarCount:function(){NI.Api.Get("/mail/messages/thread/false/read/false/_limit/1",function(e,t){var n=document.getElementById("ni-totalUnreadMessages");if(typeof n!="undefined"){n.innerHTML=t.total;t.total===0?n.style.display="none":n.style.display="block"}})}};NI.Favorite={Prepare:function(){var e=document.getElementsByClassName("ni-favorite");for(var t=0;t<e.length;t++){NI.Favorite.Init(e[t]);e[t].onclick=function(){NI.Favorite.Click(this);return!1}}},Init:function(e){var t=e.dataset.loaded;if(typeof t=="undefined"){var n=e.dataset.href,r,i=e.dataset.styleClass,s=e.dataset.styleActive,o=e.dataset.styleIcon,u=e.dataset.styleIconActive;typeof n!="undefined"&&n!==""?r=n:r=window.location.href;var a=document.createElement("a");a.className="btn";a.href="";var f=document.createElement("i");typeof o!="undefined"?f.className="fa "+o:f.className="fa fa-heart-o";if(typeof i!="undefined"){newClassName=a.className+" "+i;a.className=newClassName}e.appendChild(a);a.appendChild(f);e.dataset.loaded=!0;NI.Options.oauth_token&&NI.Api.Get("/favorites/url/"+encodeURIComponent(r),function(t,n,r){if(r.status===200){var i=e.getElementsByClassName("fa");for(r=0;r<i.length;r++)typeof u!="undefined"?i[r].className="fa "+u:i[r].className="fa fa-heart";typeof s!="undefined"&&(a.className=a.className+" "+s)}})}},Click:function(element){var href=element.dataset.href,url,a,func,tag=element.dataset.tag,activeClass=element.dataset.styleActive,alternativeIcon=element.dataset.styleIcon,alternativeActiveIcon=element.dataset.styleIconActive,postCallbackCreated=element.dataset.postCallbackCreated,postCallbackRemoved=element.dataset.postCallbackRemoved;typeof href!="undefined"&&href!==""?url=href:url=window.location.href;NI.Api.Post("/favorites/","url="+encodeURIComponent(url)+"&tag="+tag,function(error,data,x){if(x.status===201){i=element.getElementsByClassName("fa");for(x=0;x<i.length;x++)typeof alternativeActiveIcon!="undefined"?i[x].className="fa "+alternativeActiveIcon:i[x].className="fa fa-heart";if(typeof activeClass!="undefined"){a=element.getElementsByClassName("btn");for(x=0;x<a.length;x++)a[x].className=a[x].className+" "+activeClass}postCallbackCreated&&(typeof postCallbackCreated=="function"?postCallbackCreated():eval(postCallbackCreated))}else{i=element.getElementsByClassName("fa");for(x=0;x<i.length;x++)typeof alternativeIcon!="undefined"?i[x].className="fa "+alternativeIcon:i[x].className="fa fa-heart-o";if(typeof activeClass!="undefined"){a=element.getElementsByClassName("btn");for(x=0;x<a.length;x++)a[x].className=a[x].className.replace(activeClass,"").trim()}postCallbackRemoved&&(typeof postCallbackRemoved=="function"?postCallbackRemoved():eval(postCallbackRemoved))}})}};