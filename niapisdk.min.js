/*global ActiveXObject: false */window.NI=function(){var e={api_url:"https://api.newestindustry.nl",auth_url:"/oauth/auth/",client_id:!1,redirect_uri:!1,scope:"default",oauth_token:!1,refresh_token:!1,error:!1,me:!1,init:function(){var e={},t=location.hash.substring(1),n=/([^&=]+)=([^&]*)/g,r;while(r=n.exec(t))e[decodeURIComponent(r[1])]=decodeURIComponent(r[2]);if(e.token){this.oauth_token=e.token;localStorage.oauth_token=this.oauth_token}else localStorage.oauth_token&&(this.oauth_token=localStorage.oauth_token);e.error&&(this.error=e.error)},Me:function(e){this.Get("/me",e)},Login:function(){this.oauth_token||(location.href=this.api_url+this.auth_url+"?response_type=token&client_id="+this.client_id+"&redirect_uri="+this.redirect_uri+"&scope="+this.scope)},Logout:function(){this.Delete("/oauth/token");this.oauth_token=!1;localStorage.removeItem("oauth_token")},Get:function(e,t){this.call(this.api_url+e,t,"GET")},Post:function(e,t,n){typeof n=="object"&&(n=this.toQueryString(n));this.call(this.api_url+e,t,"POST",n)},Put:function(e,t,n){typeof n=="object"&&(n=this.toQueryString(n));this.call(this.api_url+e,t,"PUT",n)},Delete:function(e,t){this.call(this.api_url+e,t,"DELETE")},toQueryString:function(e){var t="",n="";for(var r in e){t+=n;t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]);n="&"}return t},call:function(e,t,n,r){var i,s,o,u;try{s=new XMLHttpRequest}catch(a){try{s=new ActiveXObject("Msxml2.XMLHTTP")}finally{typeof console!="undefined"&&console.log("NIApi: Not supported");return null}}i=setTimeout(function(){s.abort();t(new Error("NIApi: Timeout Reached"),"",s)},1e4);s.onreadystatechange=function(){if(s.readyState!==4)return;clearTimeout(i);if(s.status===200||s.status===201||s.status===204)u=!1;else if(s.status===401){this.InvalidateToken();u=new Error("NIApi: Access denied")}else u=new Error("NIApi: Response status: "+s.status);var e=JSON.parse(s.responseText);t(u,e,s)};n?o=n.toUpperCase():o="GET";s.open(o,e+"/_ts/"+Date.now(),!0);this.oauth_token&&s.setRequestHeader("Authorization","oauth_token "+this.oauth_token);if(!r)s.send();else{s.setRequestHeader("Content-type","application/x-www-form-urlencoded");s.send(r)}return!1}};return e}();