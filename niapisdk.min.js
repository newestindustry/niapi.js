/*global ActiveXObject: false */window.NI=function(){var e={api_url:"https://api.newestindustry.nl",auth_url:"/oauth/auth/",client_id:!1,redirect_uri:!1,scope:"default",oauth_token:!1,refresh_token:!1,error:!1,me:!1,init:function(e){if(typeof e!="undefined"){this.api_url=typeof e.api_url!="undefined"?e.api_url:this.api_url;this.client_id=typeof e.client_id!="undefined"?e.client_id:!1;this.redirect_uri=typeof e.redirect_uri!="undefined"?e.redirect_uri:!1}this.parseToken()},emptyCallback:function(e,t){},parseToken:function(){var e={},t=location.hash.substring(1),n=/([^&=]+)=([^&]*)/g,r;while(r=n.exec(t))e[decodeURIComponent(r[1])]=decodeURIComponent(r[2]);if(e.token){this.oauth_token=e.token;localStorage.oauth_token=this.oauth_token}else localStorage.oauth_token&&(this.oauth_token=localStorage.oauth_token);e.error&&(this.error=e.error)},Me:function(e){this.Get("/me",e)},Login:function(){this.oauth_token||(location.href=this.api_url+this.auth_url+"?response_type=token&client_id="+this.client_id+"&redirect_uri="+this.redirect_uri+"&scope="+this.scope)},Logout:function(){this.oauth_token&&this.Delete("/oauth/token",this.emptyCallback);this.oauth_token=!1;localStorage.removeItem("oauth_token")},Get:function(e,t){this.call(this.api_url+e,t,"GET")},Post:function(e,t,n){typeof n=="object"&&(n=this.toQueryString(n));this.call(this.api_url+e,t,"POST",n)},Put:function(e,t,n){typeof n=="object"&&(n=this.toQueryString(n));this.call(this.api_url+e,t,"PUT",n)},Delete:function(e,t){this.call(this.api_url+e,t,"DELETE")},toQueryString:function(e){var t="",n="";for(var r in e){t+=n;t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]);n="&"}return t},call:function(t,n,r,i){var s,o,u,a;try{o=new XMLHttpRequest}catch(f){try{o=new ActiveXObject("Msxml2.XMLHTTP")}finally{typeof console!="undefined"&&console.log("NIApi: Not supported");return null}}s=setTimeout(function(){o.abort();n(new Error("NIApi: Timeout Reached"),"",o)},1e4);o.onreadystatechange=function(){if(o.readyState!==4)return;clearTimeout(s);if(o.status===200||o.status===201||o.status===204)a=!1;else if(o.status===401){e.Logout();a=new Error("NIApi: Access denied")}else a=new Error("NIApi: Response status: "+o.status);var t=JSON.parse(o.responseText);n(a,t,o)};r?u=r.toUpperCase():u="GET";o.open(u,t+"/_ts/"+Date.now(),!0);this.oauth_token&&o.setRequestHeader("Authorization","oauth_token "+this.oauth_token);if(!i)o.send();else{o.setRequestHeader("Content-type","application/x-www-form-urlencoded");o.send(i)}return!1}};return e}();